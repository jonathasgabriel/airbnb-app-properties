{"ast":null,"code":"import _defineProperty from \"/Users/jgdharb/DevProjects/rocketSeat/airBnb/airbnb-web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nvar _jsxFileName = \"/Users/jgdharb/DevProjects/rocketSeat/airBnb/airbnb-web/src/pages/addProperty/index.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { Component } from \"react\";\nimport { withRouter } from \"react-router-dom\";\nimport querySearch from \"stringquery\";\nimport classNames from \"classnames\";\nimport PropTypes from \"prop-types\";\nimport { Form, File } from \"./styles\";\nimport api from \"../../services/api\";\n\nclass AddProperty extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      title: \"\",\n      address: \"\",\n      price: \"\",\n      error: \"\",\n      files: []\n    };\n\n    this.handleDrop = files => this.setState({\n      files\n    });\n\n    this.handleSubmit = async e => {\n      e.preventDefault();\n\n      try {\n        const _this$state = this.state,\n              title = _this$state.title,\n              address = _this$state.address,\n              price = _this$state.price,\n              latitude = _this$state.latitude,\n              longitude = _this$state.longitude,\n              files = _this$state.files;\n\n        if (!title || !address || !price || !latitude || !longitude) {\n          this.setState({\n            error: \"Preencha todos os campos\"\n          });\n          return;\n        }\n\n        const _ref = await api.post(\"/properties\", {\n          title,\n          address,\n          price,\n          latitude,\n          longitude\n        }),\n              id = _ref.data.id;\n\n        if (!files.length) this.props.history.push(\"/app\");\n        const data = new FormData();\n        files.map((file, index) => data.append(\"image[\".concat(index, \"]\"), file, file.name));\n        const config = {\n          headers: {\n            \"content-type\": \"multipart/form-data\"\n          }\n        };\n        await api.post(\"/properties/\".concat(id, \"/images\"), data, config);\n        this.props.history.push(\"/app\");\n      } catch (err) {\n        this.setState({\n          error: \"Ocorreu algum erro ao adicionar o imóvel\"\n        });\n      }\n    };\n\n    this.handleCancel = e => {\n      e.preventDefault();\n      this.props.history.push(\"/app\");\n    };\n  }\n\n  componentDidMount() {\n    const params = querySearch(this.props.location.search);\n\n    if (!params.hasOwnProperty(\"latitude\") || !params.hasOwnProperty(\"longitude\")) {\n      alert(\"É necessário definir a latitude e longitude para um imóvel.\");\n      this.props.history.push(\"/app\");\n    }\n\n    this.setState(_objectSpread({}, params));\n  }\n\n  renderFiles() {\n    const files = this.state.files;\n    return !files.length ? React.createElement(\"p\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 98\n      },\n      __self: this\n    }, \"Jogue as imagens ou clique aqui para adiciona-las\") : files.map(file => React.createElement(\"img\", {\n      alt: \"\",\n      key: file.name,\n      src: file.preview,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 100\n      },\n      __self: this\n    }));\n  }\n\n  render() {\n    return React.createElement(Form, {\n      onSubmit: this.handleSubmit,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 106\n      },\n      __self: this\n    }, React.createElement(\"h1\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 107\n      },\n      __self: this\n    }, \"Adicionar im\\xF3vel\"), React.createElement(\"hr\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 108\n      },\n      __self: this\n    }), this.state.error && React.createElement(\"p\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 109\n      },\n      __self: this\n    }, this.state.error), React.createElement(\"input\", {\n      type: \"text\",\n      placeholder: \"T\\xEDtulo\",\n      onChange: e => this.setState({\n        title: e.target.value\n      }),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 110\n      },\n      __self: this\n    }), React.createElement(\"input\", {\n      type: \"text\",\n      placeholder: \"Endere\\xE7o\",\n      onChange: e => this.setState({\n        address: e.target.value\n      }),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 115\n      },\n      __self: this\n    }), React.createElement(\"input\", {\n      type: \"decimal\",\n      placeholder: \"Pre\\xE7o\",\n      onChange: e => this.setState({\n        price: e.target.value\n      }),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 120\n      },\n      __self: this\n    }), React.createElement(File, {\n      multiple: true,\n      onDrop: this.handleDrop,\n      className: classNames({\n        \"without-files\": !this.state.files.length\n      }),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 125\n      },\n      __self: this\n    }, this.renderFiles()), React.createElement(\"div\", {\n      className: \"actions\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 132\n      },\n      __self: this\n    }, React.createElement(\"button\", {\n      type: \"submit\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 133\n      },\n      __self: this\n    }, \"Adicionar\"), React.createElement(\"button\", {\n      onClick: this.handleCancel,\n      className: \"cancel\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 134\n      },\n      __self: this\n    }, \"Cancelar\")));\n  }\n\n}\n\nAddProperty.propTypes = {\n  location: PropTypes.shape({\n    search: PropTypes.string\n  }).isRequired,\n  history: PropTypes.shape({\n    push: PropTypes.func\n  }).isRequired\n};\nexport default withRouter(AddProperty);","map":{"version":3,"sources":["/Users/jgdharb/DevProjects/rocketSeat/airBnb/airbnb-web/src/pages/addProperty/index.js"],"names":["React","Component","withRouter","querySearch","classNames","PropTypes","Form","File","api","AddProperty","state","title","address","price","error","files","handleDrop","setState","handleSubmit","e","preventDefault","latitude","longitude","post","id","data","length","props","history","push","FormData","map","file","index","append","name","config","headers","err","handleCancel","componentDidMount","params","location","search","hasOwnProperty","alert","renderFiles","preview","render","target","value","propTypes","shape","string","isRequired","func"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { withRouter } from \"react-router-dom\";\nimport querySearch from \"stringquery\";\nimport classNames from \"classnames\";\nimport PropTypes from \"prop-types\";\n\nimport { Form, File } from \"./styles\";\n\nimport api from \"../../services/api\";\n\n\nclass AddProperty extends Component {\n    static propTypes = {\n      location: PropTypes.shape({\n        search: PropTypes.string\n      }).isRequired,\n      history: PropTypes.shape({\n        push: PropTypes.func\n      }).isRequired\n    };\n  \n    state = {\n      title: \"\",\n      address: \"\",\n      price: \"\",\n      error: \"\",\n      files: []\n    };\n  \n    componentDidMount() {\n      const params = querySearch(this.props.location.search);\n      if (\n        !params.hasOwnProperty(\"latitude\") ||\n        !params.hasOwnProperty(\"longitude\")\n      ) {\n        alert(\"É necessário definir a latitude e longitude para um imóvel.\");\n        this.props.history.push(\"/app\");\n      }\n  \n      this.setState({ ...params });\n    }\n\n    handleDrop = files => this.setState({ files });\n\n    handleSubmit = async e => {\n        e.preventDefault();\n    \n        try {\n          const { title, address, price, latitude, longitude, files } = this.state;\n    \n          if (!title || !address || !price || !latitude || !longitude) {\n            this.setState({ error: \"Preencha todos os campos\" });\n            return;\n          }\n    \n          const { data: { id } } = await api.post(\"/properties\", {\n            title,\n            address,\n            price,\n            latitude,\n            longitude\n          });\n\n          if (!files.length) this.props.history.push(\"/app\");\n  \n          const data = new FormData();\n          files.map((file, index) =>\n            data.append(`image[${index}]`, file, file.name)\n          );\n    \n          const config = {\n            headers: {\n              \"content-type\": \"multipart/form-data\"\n            }\n          };\n    \n          await api.post(\n            `/properties/${id}/images`,\n            data,\n            config\n          );\n    \n          this.props.history.push(\"/app\");\n        } catch (err) {\n          this.setState({ error: \"Ocorreu algum erro ao adicionar o imóvel\" });\n        }\n      };\n\n      handleCancel = e => {\n        e.preventDefault();\n      \n        this.props.history.push(\"/app\");\n      };\n\n    renderFiles() {\n        const { files } = this.state;\n        return !files.length ? (\n            <p>Jogue as imagens ou clique aqui para adiciona-las</p>\n        ) : (\n            files.map(file => <img alt=\"\" key={file.name} src={file.preview} />)\n        );\n    }\n\n    render() {\n        return (\n          <Form onSubmit={this.handleSubmit}>\n            <h1>Adicionar imóvel</h1>\n            <hr />\n            {this.state.error && <p>{this.state.error}</p>}\n            <input\n              type=\"text\"\n              placeholder=\"Título\"\n              onChange={e => this.setState({ title: e.target.value })}\n            />\n            <input\n              type=\"text\"\n              placeholder=\"Endereço\"\n              onChange={e => this.setState({ address: e.target.value })}\n            />\n            <input\n              type=\"decimal\"\n              placeholder=\"Preço\"\n              onChange={e => this.setState({ price: e.target.value })}\n            />\n            <File\n              multiple\n              onDrop={this.handleDrop}\n              className={classNames({ \"without-files\": !this.state.files.length })}\n            >\n              {this.renderFiles()}\n            </File>\n            <div className=\"actions\">\n              <button type=\"submit\">Adicionar</button>\n              <button onClick={this.handleCancel} className=\"cancel\">\n                Cancelar\n              </button>\n            </div>\n          </Form>\n        );\n      }\n    }\n    \n    export default withRouter(AddProperty);"]},"metadata":{},"sourceType":"module"}